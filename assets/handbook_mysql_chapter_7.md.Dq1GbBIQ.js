import{_ as i,c as a,o as n,aj as l}from"./chunks/framework.CynFBi0q.js";const g=JSON.parse('{"title":"MySQL 数据库应用指南：第7章 数据定义语言（DDL）深入","description":"","frontmatter":{},"headers":[],"relativePath":"handbook/mysql/chapter_7.md","filePath":"handbook/mysql/chapter_7.md","lastUpdated":1769350105000}'),h={name:"handbook/mysql/chapter_7.md"};function e(t,s,p,k,r,d){return n(),a("div",null,[...s[0]||(s[0]=[l(`<h1 id="mysql-数据库应用指南-第7章-数据定义语言-ddl-深入" tabindex="-1">MySQL 数据库应用指南：第7章 数据定义语言（DDL）深入 <a class="header-anchor" href="#mysql-数据库应用指南-第7章-数据定义语言-ddl-深入" aria-label="Permalink to “MySQL 数据库应用指南：第7章 数据定义语言（DDL）深入”">​</a></h1><p>数据定义语言（DDL）是构建 MySQL 数据库结构的核心，涵盖数据表、字段、约束、索引、视图等对象的创建、修改与删除。不同于 DML 聚焦数据操作，DDL 决定了数据库的“骨架”——合理的 DDL 设计能提升数据存储效率、保证数据完整性，而糟糕的设计会导致性能瓶颈、数据混乱。本章将深入讲解 DDL 的核心知识点，帮你掌握规范的数据库结构设计思路。</p><h2 id="_7-1-数据表字段的数据类型详解与选择原则" tabindex="-1">7.1 数据表字段的数据类型详解与选择原则 <a class="header-anchor" href="#_7-1-数据表字段的数据类型详解与选择原则" aria-label="Permalink to “7.1 数据表字段的数据类型详解与选择原则”">​</a></h2><p>MySQL 提供了丰富的数据类型，不同类型对应不同的存储场景和性能特征。选择合适的数据类型是 DDL 设计的第一步，也是避免后续性能问题的关键。</p><h3 id="_7-1-1-常用数据类型分类" tabindex="-1">7.1.1 常用数据类型分类 <a class="header-anchor" href="#_7-1-1-常用数据类型分类" aria-label="Permalink to “7.1.1 常用数据类型分类”">​</a></h3><p>MySQL 数据类型可分为 5 大类，以下是高频使用的类型及适用场景：</p><h4 id="_1-数值类型" tabindex="-1">1. 数值类型 <a class="header-anchor" href="#_1-数值类型" aria-label="Permalink to “1. 数值类型”">​</a></h4><table tabindex="0"><thead><tr><th>类型</th><th>存储范围</th><th>占用空间</th><th>适用场景</th></tr></thead><tbody><tr><td><code>TINYINT</code></td><td>-128 ~ 127（无符号 0~255）</td><td>1 字节</td><td>状态值（0/1）、性别（1/2）等小整数</td></tr><tr><td><code>INT</code></td><td>-2^31 ~ 2^31-1（无符号 0~2^32-1）</td><td>4 字节</td><td>主键 ID、年龄、数量等常规整数</td></tr><tr><td><code>BIGINT</code></td><td>-2^63 ~ 2^63-1</td><td>8 字节</td><td>超大整数（如订单号、雪花ID）</td></tr><tr><td><code>DECIMAL(M,D)</code></td><td>精准小数（M 总位数，D 小数位）</td><td>可变</td><td>金额、价格（避免浮点精度丢失）</td></tr><tr><td><code>FLOAT</code></td><td>单精度浮点</td><td>4 字节</td><td>非精准数值（如身高、体重）</td></tr><tr><td><code>DOUBLE</code></td><td>双精度浮点</td><td>8 字节</td><td>非精准大数（如科学计算）</td></tr></tbody></table><p><strong>核心原则</strong>：优先选最小够用的类型（如状态用 TINYINT 而非 INT）；金额必须用 DECIMAL，避免 FLOAT/DOUBLE 精度丢失。</p><h4 id="_2-字符串类型" tabindex="-1">2. 字符串类型 <a class="header-anchor" href="#_2-字符串类型" aria-label="Permalink to “2. 字符串类型”">​</a></h4><table tabindex="0"><thead><tr><th>类型</th><th>特点</th><th>占用空间</th><th>适用场景</th></tr></thead><tbody><tr><td><code>CHAR(N)</code></td><td>固定长度，不足补空格</td><td>N 字节（N≤255）</td><td>短字符串（手机号、身份证号、邮编）</td></tr><tr><td><code>VARCHAR(N)</code></td><td>可变长度，按需存储</td><td>1~2 字节 + 实际长度</td><td>名称、地址、描述等变长字符串</td></tr><tr><td><code>TEXT</code></td><td>长文本</td><td>可变（最大 65535 字节）</td><td>文章内容、备注等长文本</td></tr><tr><td><code>LONGTEXT</code></td><td>超长文本</td><td>可变（最大 4GB）</td><td>超大文本（如日志、富文本）</td></tr></tbody></table><p><strong>核心原则</strong>：固定长度用 CHAR（如手机号 11 位），可变长度用 VARCHAR；长文本优先用 TEXT，避免 VARCHAR 过长导致行溢出。</p><h4 id="_3-日期时间类型" tabindex="-1">3. 日期时间类型 <a class="header-anchor" href="#_3-日期时间类型" aria-label="Permalink to “3. 日期时间类型”">​</a></h4><table tabindex="0"><thead><tr><th>类型</th><th>格式</th><th>占用空间</th><th>适用场景</th></tr></thead><tbody><tr><td><code>DATE</code></td><td>YYYY-MM-DD</td><td>3 字节</td><td>生日、日期等仅需日期的场景</td></tr><tr><td><code>TIME</code></td><td>HH:MM:SS</td><td>3 字节</td><td>时间点（如上课时间）</td></tr><tr><td><code>DATETIME</code></td><td>YYYY-MM-DD HH:MM:SS</td><td>8 字节</td><td>记录时间（如创建时间、更新时间）</td></tr><tr><td><code>TIMESTAMP</code></td><td>YYYY-MM-DD HH:MM:SS</td><td>4 字节</td><td>时间戳（自动更新、时区转换）</td></tr></tbody></table><p><strong>核心原则</strong>：DATETIME 无时区问题，适合业务时间；TIMESTAMP 占用空间小，支持自动更新（如 <code>ON UPDATE CURRENT_TIMESTAMP</code>）。</p><h4 id="_4-枚举-集合类型" tabindex="-1">4. 枚举/集合类型 <a class="header-anchor" href="#_4-枚举-集合类型" aria-label="Permalink to “4. 枚举/集合类型”">​</a></h4><ul><li><code>ENUM(&#39;值1&#39;,&#39;值2&#39;,...)</code>：枚举类型，只能选其中一个值（如性别 <code>ENUM(&#39;男&#39;,&#39;女&#39;)</code>）；</li><li><code>SET(&#39;值1&#39;,&#39;值2&#39;,...)</code>：集合类型，可多选（如爱好 <code>SET(&#39;读书&#39;,&#39;运动&#39;,&#39;音乐&#39;)</code>）。</li></ul><h4 id="_5-特殊类型" tabindex="-1">5. 特殊类型 <a class="header-anchor" href="#_5-特殊类型" aria-label="Permalink to “5. 特殊类型”">​</a></h4><ul><li><code>BOOLEAN</code>：布尔类型（等价于 TINYINT(1)，0 为 false，1 为 true）；</li><li><code>JSON</code>：JSON 格式数据（MySQL 5.7+ 支持），适合存储非结构化数据（如配置、扩展字段）。</li></ul><h3 id="_7-1-2-数据类型选择原则" tabindex="-1">7.1.2 数据类型选择原则 <a class="header-anchor" href="#_7-1-2-数据类型选择原则" aria-label="Permalink to “7.1.2 数据类型选择原则”">​</a></h3><ol><li><strong>最小够用</strong>：避免用 BIGINT 存储年龄、INT 存储状态，减少存储空间和 IO 开销；</li><li><strong>精准优先</strong>：金额、价格用 DECIMAL，不用浮点类型；</li><li><strong>字符集匹配</strong>：字符串字段统一用 <code>utf8mb4</code>，支持 emoji 和特殊字符；</li><li><strong>避免过度设计</strong>：不要用 TEXT 存储短字符串，不要用 VARCHAR(255) 存储固定长度的手机号；</li><li><strong>考虑索引</strong>：过长的 VARCHAR 字段不适合做索引（索引长度有限制）。</li></ol><h3 id="_7-1-3-反例与优化示例" tabindex="-1">7.1.3 反例与优化示例 <a class="header-anchor" href="#_7-1-3-反例与优化示例" aria-label="Permalink to “7.1.3 反例与优化示例”">​</a></h3><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 反例：字段类型选择不合理</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bad_design</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BIGINT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 普通主键用BIGINT，浪费空间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  age </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FLOAT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 年龄用浮点，无意义</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  phone </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 手机号固定11位，用CHAR(11)更优</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  price DOUBLE  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 价格用浮点，精度丢失</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 优化后</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> good_design</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AUTO_INCREMENT,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 普通主键用INT足够</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  age </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TINYINT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 年龄最大100+，TINYINT够用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  phone </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 固定长度用CHAR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  price </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DECIMAL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 价格用DECIMAL保证精准</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="_7-2-字段约束-主键、外键、唯一、非空、默认值" tabindex="-1">7.2 字段约束（主键、外键、唯一、非空、默认值） <a class="header-anchor" href="#_7-2-字段约束-主键、外键、唯一、非空、默认值" aria-label="Permalink to “7.2 字段约束（主键、外键、唯一、非空、默认值）”">​</a></h2><p>字段约束是保证数据完整性的核心机制，通过约束可避免脏数据（如非空字段插入 NULL、唯一字段重复），减少业务层校验逻辑。</p><h3 id="_7-2-1-核心约束类型" tabindex="-1">7.2.1 核心约束类型 <a class="header-anchor" href="#_7-2-1-核心约束类型" aria-label="Permalink to “7.2.1 核心约束类型”">​</a></h3><table tabindex="0"><thead><tr><th>约束</th><th>关键字</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td>非空约束</td><td><code>NOT NULL</code></td><td>字段不能为空</td><td><code>name VARCHAR(50) NOT NULL</code></td></tr><tr><td>默认值约束</td><td><code>DEFAULT</code></td><td>字段未赋值时用默认值</td><td><code>status TINYINT DEFAULT 0</code></td></tr><tr><td>唯一约束</td><td><code>UNIQUE</code></td><td>字段值唯一（可多个 NULL）</td><td><code>phone CHAR(11) UNIQUE</code></td></tr><tr><td>主键约束</td><td><code>PRIMARY KEY</code></td><td>唯一标识记录（非空+唯一）</td><td><code>id INT PRIMARY KEY AUTO_INCREMENT</code></td></tr><tr><td>外键约束</td><td><code>FOREIGN KEY</code></td><td>关联另一张表的主键，保证引用完整性</td><td><code>class_id INT FOREIGN KEY REFERENCES class(id)</code></td></tr></tbody></table><h3 id="_7-2-2-约束实战示例" tabindex="-1">7.2.2 约束实战示例 <a class="header-anchor" href="#_7-2-2-约束实战示例" aria-label="Permalink to “7.2.2 约束实战示例”">​</a></h3><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 创建带完整约束的学生表</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> student</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AUTO_INCREMENT,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 主键，自增</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 非空</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  gender ENUM(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;男&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;女&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;男&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 默认值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  phone </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UNIQUE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,             </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 唯一</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 外键关联班级表</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  -- 外键约束定义</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  FOREIGN KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (class_id) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">REFERENCES</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> class(id)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ON DELETE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> SET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NULL</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  -- 班级删除时，学生class_id设为NULL</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    ON UPDATE CASCADE</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   -- 班级ID更新时，学生class_id同步更新</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) CHARSET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">utf8mb4;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 创建班级表（被外键关联，需先创建）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AUTO_INCREMENT,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  class_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> UNIQUE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_7-2-3-约束使用注意事项" tabindex="-1">7.2.3 约束使用注意事项 <a class="header-anchor" href="#_7-2-3-约束使用注意事项" aria-label="Permalink to “7.2.3 约束使用注意事项”">​</a></h3><ol><li><strong>主键设计</strong>： <ul><li>优先用自增 INT/BIGINT 作为主键（性能最优）；</li><li>单表只能有一个主键，复合主键（多个字段）尽量避免；</li></ul></li><li><strong>外键约束</strong>： <ul><li>InnoDB 支持外键，MyISAM 不支持；</li><li>外键会增加性能开销（关联校验），高并发场景可在业务层保证引用完整性，不建外键；</li><li><code>ON DELETE/UPDATE</code> 需谨慎：避免 <code>ON DELETE CASCADE</code>（级联删除，易误删数据）；</li></ul></li><li><strong>唯一约束</strong>：可创建复合唯一索引（如 <code>UNIQUE (name, phone)</code>），保证组合值唯一；</li><li><strong>非空约束</strong>：核心字段（如名称、金额）必须加 NOT NULL，避免 NULL 导致的查询/计算问题。</li></ol><h2 id="_7-3-数据表结构的修改-alter-table-操作" tabindex="-1">7.3 数据表结构的修改（ALTER TABLE）操作 <a class="header-anchor" href="#_7-3-数据表结构的修改-alter-table-操作" aria-label="Permalink to “7.3 数据表结构的修改（ALTER TABLE）操作”">​</a></h2><p>表创建后，常因需求变更需要修改结构（如新增字段、修改类型、删除约束），<code>ALTER TABLE</code> 是 DDL 中最常用的修改命令，需谨慎使用（尤其生产环境）。</p><h3 id="_7-3-1-alter-table-核心语法" tabindex="-1">7.3.1 ALTER TABLE 核心语法 <a class="header-anchor" href="#_7-3-1-alter-table-核心语法" aria-label="Permalink to “7.3.1 ALTER TABLE 核心语法”">​</a></h3><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 表名</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ADD 字段名 类型 [约束],  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 新增字段</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> MODIFY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 字段名 新类型 [约束],  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 修改字段类型/约束</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CHANGE 旧字段名 新字段名 类型 [约束],  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 重命名字段</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DROP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 字段名,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 删除字段</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ADD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> CONSTRAINT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 约束名 约束类型(字段名)];  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 新增约束</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_7-3-2-常见修改场景示例" tabindex="-1">7.3.2 常见修改场景示例 <a class="header-anchor" href="#_7-3-2-常见修改场景示例" aria-label="Permalink to “7.3.2 常见修改场景示例”">​</a></h3><h4 id="示例1-新增字段" tabindex="-1">示例1：新增字段 <a class="header-anchor" href="#示例1-新增字段" aria-label="Permalink to “示例1：新增字段”">​</a></h4><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 给student表新增“邮箱”字段（允许空，唯一）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ADD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COLUMN email </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UNIQUE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AFTER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> phone;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- AFTER phone：指定字段位置（可选，默认加在最后）</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="示例2-修改字段类型-约束" tabindex="-1">示例2：修改字段类型/约束 <a class="header-anchor" href="#示例2-修改字段类型-约束" aria-label="Permalink to “示例2：修改字段类型/约束”">​</a></h4><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 将student表的phone字段从CHAR(11)改为VARCHAR(20)（支持国际手机号）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">MODIFY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COLUMN phone </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UNIQUE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 注意：修改类型时需确保现有数据兼容（如CHAR转VARCHAR无问题，INT转TINYINT需检查值范围）</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="示例3-重命名字段" tabindex="-1">示例3：重命名字段 <a class="header-anchor" href="#示例3-重命名字段" aria-label="Permalink to “示例3：重命名字段”">​</a></h4><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 将email字段重命名为user_email</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">CHANGE COLUMN email user_email </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">UNIQUE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="示例4-删除字段-约束" tabindex="-1">示例4：删除字段/约束 <a class="header-anchor" href="#示例4-删除字段-约束" aria-label="Permalink to “示例4：删除字段/约束”">​</a></h4><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 删除user_email字段</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DROP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COLUMN user_email;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 删除phone字段的唯一约束（需先查约束名）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 1. 查约束名：SHOW INDEX FROM student WHERE Key_name = &#39;phone&#39;;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 2. 删除约束：</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DROP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> INDEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> phone;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="示例5-新增主键-外键" tabindex="-1">示例5：新增主键/外键 <a class="header-anchor" href="#示例5-新增主键-外键" aria-label="Permalink to “示例5：新增主键/外键”">​</a></h4><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 给临时表新增主键</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> temp_table</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ADD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (id);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 给student表新增外键（关联年级表）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ADD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> CONSTRAINT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fk_student_grade</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FOREIGN KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (grade_id) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">REFERENCES</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> grade(id);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_7-3-3-alter-table-注意事项" tabindex="-1">7.3.3 ALTER TABLE 注意事项 <a class="header-anchor" href="#_7-3-3-alter-table-注意事项" aria-label="Permalink to “7.3.3 ALTER TABLE 注意事项”">​</a></h3><ol><li><strong>锁表风险</strong>：修改大表结构（如千万级数据）会锁表，导致读写阻塞，生产环境需在低峰期操作；</li><li><strong>数据兼容</strong>：修改字段类型前，先执行 <code>SELECT</code> 检查现有数据是否超出新类型范围；</li><li><strong>性能影响</strong>：新增字段（尤其是非空且无默认值）会重写全表数据，耗时较长；</li><li><strong>备份优先</strong>：修改表结构前务必备份表数据，避免操作失误导致数据丢失。</li></ol><blockquote><p>补充：MySQL 8.0 支持 <code>ALTER TABLE ... ALGORITHM=INPLACE</code>（无锁修改），可减少锁表时间，具体参考官方文档：<a href="https://dev.mysql.com/doc/refman/8.0/en/alter-table.html" target="_blank" rel="noreferrer">https://dev.mysql.com/doc/refman/8.0/en/alter-table.html</a></p></blockquote><h2 id="_7-4-索引的创建、查看与删除-基础" tabindex="-1">7.4 索引的创建、查看与删除（基础） <a class="header-anchor" href="#_7-4-索引的创建、查看与删除-基础" aria-label="Permalink to “7.4 索引的创建、查看与删除（基础）”">​</a></h2><p>索引是提升查询性能的核心手段，本质是“数据结构（B+树）”，能快速定位数据行，避免全表扫描。本节讲解基础索引操作，进阶优化见后续章节。</p><h3 id="_7-4-1-索引的基础概念" tabindex="-1">7.4.1 索引的基础概念 <a class="header-anchor" href="#_7-4-1-索引的基础概念" aria-label="Permalink to “7.4.1 索引的基础概念”">​</a></h3><ul><li><strong>作用</strong>：加速查询（SELECT），但会降低 DML（INSERT/UPDATE/DELETE）性能（需维护索引）；</li><li><strong>核心类型</strong>： <ul><li>主键索引（PRIMARY KEY）：默认创建，唯一且非空；</li><li>唯一索引（UNIQUE）：字段值唯一，可含 NULL；</li><li>普通索引（INDEX）：无唯一性约束，加速查询；</li><li>复合索引：多个字段组成的索引（如 <code>INDEX (name, age)</code>）。</li></ul></li></ul><h3 id="_7-4-2-索引的创建" tabindex="-1">7.4.2 索引的创建 <a class="header-anchor" href="#_7-4-2-索引的创建" aria-label="Permalink to “7.4.2 索引的创建”">​</a></h3><h4 id="_1-创建表时创建索引" tabindex="-1">1. 创建表时创建索引 <a class="header-anchor" href="#_1-创建表时创建索引" aria-label="Permalink to “1. 创建表时创建索引”">​</a></h4><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> goods</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AUTO_INCREMENT,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 主键索引</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  price </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DECIMAL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  -- 普通索引</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  INDEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idx_price (price),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  -- 唯一索引</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  UNIQUE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> INDEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idx_name (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  -- 复合索引</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  INDEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idx_name_price (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, price)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) CHARSET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">utf8mb4;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_2-表创建后创建索引-alter-table-create-index" tabindex="-1">2. 表创建后创建索引（ALTER TABLE/ CREATE INDEX） <a class="header-anchor" href="#_2-表创建后创建索引-alter-table-create-index" aria-label="Permalink to “2. 表创建后创建索引（ALTER TABLE/ CREATE INDEX）”">​</a></h4><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 方式1：ALTER TABLE（推荐，可创建所有类型索引）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> goods</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ADD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> INDEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idx_stock (stock);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 普通索引</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> goods</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ADD</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> UNIQUE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> INDEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idx_code (goods_code);  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 唯一索引</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 方式2：CREATE INDEX（仅创建普通/唯一索引）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> INDEX</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> idx_create_time</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> goods(create_time);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> UNIQUE INDEX</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> idx_phone</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student(phone);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_7-4-3-索引的查看" tabindex="-1">7.4.3 索引的查看 <a class="header-anchor" href="#_7-4-3-索引的查看" aria-label="Permalink to “7.4.3 索引的查看”">​</a></h3><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 查看表的所有索引</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SHOW </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INDEX</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> goods;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 或</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SHOW KEYS </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> goods;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 简化查看（只看索引名和字段）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> INDEX_NAME, COLUMN_NAME</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> INFORMATION_SCHEMA</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">STATISTICS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TABLE_NAME </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;goods&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_7-4-4-索引的删除" tabindex="-1">7.4.4 索引的删除 <a class="header-anchor" href="#_7-4-4-索引的删除" aria-label="Permalink to “7.4.4 索引的删除”">​</a></h3><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 方式1：ALTER TABLE</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> goods</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DROP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> INDEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idx_price;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 删除普通索引</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> goods</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DROP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> INDEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idx_name;   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 删除唯一索引</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 方式2：DROP INDEX</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DROP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> INDEX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idx_create_time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> goods;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 注意：主键索引不能直接DROP，需先修改：</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> goods</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DROP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_7-4-5-基础索引使用原则" tabindex="-1">7.4.5 基础索引使用原则 <a class="header-anchor" href="#_7-4-5-基础索引使用原则" aria-label="Permalink to “7.4.5 基础索引使用原则”">​</a></h3><ol><li><strong>索引不是越多越好</strong>：每张表建议索引数≤5个，过多会降低 DML 性能；</li><li><strong>适合索引的字段</strong>：WHERE 子句中频繁筛选的字段（如 price、create_time）、JOIN 关联字段；</li><li><strong>不适合索引的字段</strong>： <ul><li>低基数字段（如性别、状态，值只有几种）；</li><li>频繁更新的字段；</li><li>过长的字符串字段（可截取前缀索引）；</li></ul></li><li><strong>复合索引遵循最左匹配</strong>：创建 <code>INDEX (a,b,c)</code>，查询条件需包含 a 才能触发索引（如 WHERE a=1、WHERE a=1 AND b=2 生效，WHERE b=2 不生效）。</li></ol><h2 id="_7-5-视图的创建与基础使用" tabindex="-1">7.5 视图的创建与基础使用 <a class="header-anchor" href="#_7-5-视图的创建与基础使用" aria-label="Permalink to “7.5 视图的创建与基础使用”">​</a></h2><p>视图（View）是基于查询结果的“虚拟表”，不存储实际数据，仅保存查询逻辑。视图可简化复杂查询、控制数据访问权限，是数据库设计的常用工具。</p><h3 id="_7-5-1-视图的核心作用" tabindex="-1">7.5.1 视图的核心作用 <a class="header-anchor" href="#_7-5-1-视图的核心作用" aria-label="Permalink to “7.5.1 视图的核心作用”">​</a></h3><ol><li><strong>简化复杂查询</strong>：将多表关联、聚合的复杂查询封装为视图，调用时只需 <code>SELECT * FROM 视图名</code>；</li><li><strong>权限控制</strong>：只开放视图权限，不开放原表权限（如只让用户查看订单的部分字段）；</li><li><strong>数据抽象</strong>：屏蔽表结构变更，视图逻辑不变，业务层无需修改。</li></ol><h3 id="_7-5-2-视图的创建" tabindex="-1">7.5.2 视图的创建 <a class="header-anchor" href="#_7-5-2-视图的创建" aria-label="Permalink to “7.5.2 视图的创建”">​</a></h3><h4 id="语法" tabindex="-1">语法： <a class="header-anchor" href="#语法" aria-label="Permalink to “语法：”">​</a></h4><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [OR REPLACE] VIEW 视图名 [(字段别名)]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 查询语句</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[WITH CHECK OPTION];  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 保证通过视图修改的数据符合查询条件</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="示例1-创建简单视图" tabindex="-1">示例1：创建简单视图 <a class="header-anchor" href="#示例1-创建简单视图" aria-label="Permalink to “示例1：创建简单视图”">​</a></h4><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 创建“学生成绩视图”（关联学生表和成绩表）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> VIEW</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> v_student_score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">class_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">subject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">score</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student s</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LEFT JOIN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> score sc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">student_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 调用视图（和普通表用法一致）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v_student_score </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> class_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="示例2-创建带筛选的视图-权限控制" tabindex="-1">示例2：创建带筛选的视图（权限控制） <a class="header-anchor" href="#示例2-创建带筛选的视图-权限控制" aria-label="Permalink to “示例2：创建带筛选的视图（权限控制）”">​</a></h4><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 创建“仅显示高一(1)班学生的视图”</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> VIEW</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> v_class1_student</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, age </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> class_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WITH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> CHECK</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> OPTION</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 确保通过视图新增/修改的学生class_id=1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 通过视图新增数据（会自动满足class_id=1）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v_class1_student (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, age) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;周九&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 执行后，student表中该记录的class_id=1（视图自动补充）</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_7-5-3-视图的查看与修改" tabindex="-1">7.5.3 视图的查看与修改 <a class="header-anchor" href="#_7-5-3-视图的查看与修改" aria-label="Permalink to “7.5.3 视图的查看与修改”">​</a></h3><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 查看所有视图</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SHOW VIEWS;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 查看视图创建语句</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SHOW </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> VIEW v_student_score;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 修改视图（替换原有逻辑）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE OR REPLACE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> VIEW</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> v_student_score</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> AS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SELECT</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">class_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">subject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">score</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> student s</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LEFT JOIN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> class c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">class_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> c</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">LEFT JOIN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> score sc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ON</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">student_id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_7-5-4-视图的删除" tabindex="-1">7.5.4 视图的删除 <a class="header-anchor" href="#_7-5-4-视图的删除" aria-label="Permalink to “7.5.4 视图的删除”">​</a></h3><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DROP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> VIEW</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> IF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> EXISTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v_student_score;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 批量删除</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DROP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> VIEW</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> IF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> EXISTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v_class1_student, v_student_score;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_7-5-5-视图使用注意事项" tabindex="-1">7.5.5 视图使用注意事项 <a class="header-anchor" href="#_7-5-5-视图使用注意事项" aria-label="Permalink to “7.5.5 视图使用注意事项”">​</a></h3><ol><li><strong>性能问题</strong>：视图本质是执行查询语句，复杂视图（多表关联+聚合）查询效率低，不宜过度使用；</li><li><strong>更新限制</strong>：包含聚合函数、DISTINCT、JOIN 的视图无法更新（INSERT/UPDATE/DELETE）；</li><li><strong>权限控制</strong>：创建视图需 <code>CREATE VIEW</code> 权限，调用视图需原表的查询权限；</li><li><strong>避免嵌套视图</strong>：视图调用视图会大幅降低性能，尽量直接基于原表创建。</li></ol><h2 id="_7-6-ddl操作对数据库性能的影响" tabindex="-1">7.6 DDL操作对数据库性能的影响 <a class="header-anchor" href="#_7-6-ddl操作对数据库性能的影响" aria-label="Permalink to “7.6 DDL操作对数据库性能的影响”">​</a></h2><p>DDL 操作（建表、改表、建索引、删索引）看似是“结构调整”，实则会直接影响数据库性能，尤其是生产环境的大表操作，需重点关注。</p><h3 id="_7-6-1-不同ddl操作的性能影响" tabindex="-1">7.6.1 不同DDL操作的性能影响 <a class="header-anchor" href="#_7-6-1-不同ddl操作的性能影响" aria-label="Permalink to “7.6.1 不同DDL操作的性能影响”">​</a></h3><table tabindex="0"><thead><tr><th>DDL操作</th><th>性能影响</th><th>风险点</th></tr></thead><tbody><tr><td>创建表（CREATE TABLE）</td><td>低（仅创建元数据）</td><td>无</td></tr><tr><td>新增字段（ALTER TABLE ADD）</td><td>中-高（大表需重写数据）</td><td>锁表、IO 飙升</td></tr><tr><td>修改字段类型（MODIFY）</td><td>高（全表数据重写）</td><td>长时间锁表、业务阻塞</td></tr><tr><td>删除字段（DROP COLUMN）</td><td>中（大表需清理数据）</td><td>锁表、数据不可逆</td></tr><tr><td>创建索引（ADD INDEX）</td><td>高（需扫描全表构建索引）</td><td>锁表、CPU/IO 占用高</td></tr><tr><td>删除索引（DROP INDEX）</td><td>低（仅删除元数据）</td><td>无</td></tr><tr><td>创建视图（CREATE VIEW）</td><td>无（仅保存查询逻辑）</td><td>无</td></tr></tbody></table><h3 id="_7-6-2-生产环境ddl操作优化建议" tabindex="-1">7.6.2 生产环境DDL操作优化建议 <a class="header-anchor" href="#_7-6-2-生产环境ddl操作优化建议" aria-label="Permalink to “7.6.2 生产环境DDL操作优化建议”">​</a></h3><ol><li><strong>选择低峰期操作</strong>：如凌晨 2-4 点，减少对业务的影响；</li><li><strong>大表操作分批/异步</strong>： <ul><li>新增索引：用 <code>ALTER TABLE ... ALGORITHM=INPLACE</code>（MySQL 8.0），避免锁表；</li><li>修改表结构：先在从库测试，再同步到主库；或用第三方工具（如 pt-online-schema-change）无锁改表；</li></ul></li><li><strong>避免频繁DDL</strong>：表结构设计尽量前置，上线后减少修改；</li><li><strong>监控资源占用</strong>：执行 DDL 时监控 CPU、IO、锁等待，发现异常立即终止；</li><li><strong>索引创建优化</strong>： <ul><li>先删除大表的冗余索引，再创建新索引；</li><li>避免在业务高峰创建索引（索引构建会扫描全表，占用 IO）。</li></ul></li></ol><h3 id="_7-6-3-风险规避措施" tabindex="-1">7.6.3 风险规避措施 <a class="header-anchor" href="#_7-6-3-风险规避措施" aria-label="Permalink to “7.6.3 风险规避措施”">​</a></h3><ol><li><strong>操作前备份</strong>：执行 ALTER TABLE、DROP INDEX 前，备份表数据（mysqldump 或物理备份）；</li><li><strong>先测试后执行</strong>：在测试环境复现生产数据量，验证 DDL 操作的耗时和影响；</li><li><strong>限制DDL权限</strong>：仅授权 DBA 执行 DDL 操作，开发人员禁止直接操作生产库。</li></ol><h3 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to “总结”">​</a></h3><ol><li>数据类型选择需遵循“最小够用、精准优先”原则，金额用 DECIMAL、固定长度字符串用 CHAR、可变长度用 VARCHAR；</li><li>字段约束是数据完整性的保障，主键非空且唯一，外键谨慎使用，核心字段加非空约束；</li><li>ALTER TABLE 需注意锁表风险，生产环境大表修改优先用无锁算法，低峰期操作；</li><li>索引能加速查询但会降低 DML 性能，遵循“最左匹配”原则，避免过度索引；</li><li>视图简化复杂查询、控制权限，但复杂视图会影响性能，避免嵌套使用；</li><li>生产环境执行 DDL 前务必备份、测试，选择低峰期操作，监控资源占用。</li></ol><p>本章的 DDL 知识是数据库设计的核心，合理的表结构、约束、索引设计，能让后续的 DML、查询操作事半功倍。建议在设计表时，先梳理业务场景，明确字段类型和约束，再逐步优化索引和视图，避免“先上线再优化”的被动局面。下一章将深入讲解索引原理与性能优化，进一步提升数据库操作效率。</p>`,92)])])}const c=i(h,[["render",e]]);export{g as __pageData,c as default};
