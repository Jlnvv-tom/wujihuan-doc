import{_ as i,c as a,o as n,aj as l}from"./chunks/framework.CynFBi0q.js";const b=JSON.parse('{"title":"MySQL 数据库应用指南：第13章 MySQL备份与恢复","description":"","frontmatter":{},"headers":[],"relativePath":"handbook/mysql/chapter_13.md","filePath":"handbook/mysql/chapter_13.md","lastUpdated":1769350105000}'),h={name:"handbook/mysql/chapter_13.md"};function t(p,s,e,k,r,d){return n(),a("div",null,[...s[0]||(s[0]=[l(`<h1 id="mysql-数据库应用指南-第13章-mysql备份与恢复" tabindex="-1">MySQL 数据库应用指南：第13章 MySQL备份与恢复 <a class="header-anchor" href="#mysql-数据库应用指南-第13章-mysql备份与恢复" aria-label="Permalink to “MySQL 数据库应用指南：第13章 MySQL备份与恢复”">​</a></h1><p>数据是业务的核心资产，而备份与恢复则是保障数据安全的最后一道防线——无论是硬件故障、人为误操作，还是黑客攻击，完善的备份策略和熟练的恢复技巧都能将数据损失降到最低。本章将从备份策略制定、工具实战，到恢复流程、方案优化，全面讲解 MySQL 备份与恢复的核心知识点，帮你构建“可备份、可恢复、可验证”的全链路数据保障体系。</p><h2 id="_13-1-数据备份的重要性与备份策略制定" tabindex="-1">13.1 数据备份的重要性与备份策略制定 <a class="header-anchor" href="#_13-1-数据备份的重要性与备份策略制定" aria-label="Permalink to “13.1 数据备份的重要性与备份策略制定”">​</a></h2><h3 id="_13-1-1-备份的核心价值" tabindex="-1">13.1.1 备份的核心价值 <a class="header-anchor" href="#_13-1-1-备份的核心价值" aria-label="Permalink to “13.1.1 备份的核心价值”">​</a></h3><ul><li><strong>灾难恢复</strong>：服务器宕机、硬盘损坏、机房火灾等物理故障时，通过备份恢复数据；</li><li><strong>误操作回滚</strong>：删除表、更新错数据、DROP 数据库等人为失误时，快速恢复到正确状态；</li><li><strong>数据迁移/克隆</strong>：将数据从测试环境迁移到生产环境，或克隆相同的数据库实例；</li><li><strong>合规要求</strong>：金融、医疗等行业的合规审计要求保留指定周期的备份数据。</li></ul><h3 id="_13-1-2-备份策略的核心维度" tabindex="-1">13.1.2 备份策略的核心维度 <a class="header-anchor" href="#_13-1-2-备份策略的核心维度" aria-label="Permalink to “13.1.2 备份策略的核心维度”">​</a></h3><p>制定备份策略需明确以下 5 个核心问题，避免“备份了但恢复不了”的无效操作：</p><h4 id="_1-备份类型选择" tabindex="-1">1. 备份类型选择 <a class="header-anchor" href="#_1-备份类型选择" aria-label="Permalink to “1. 备份类型选择”">​</a></h4><table tabindex="0"><thead><tr><th>维度</th><th>选项</th><th>适用场景</th></tr></thead><tbody><tr><td>数据范围</td><td>全量备份</td><td>每周/每月基础备份，恢复起点</td></tr><tr><td></td><td>增量备份</td><td>每天/每小时增量，减少备份体积</td></tr><tr><td></td><td>差异备份</td><td>自全量以来的所有变更，比增量恢复更快</td></tr><tr><td>备份方式</td><td>逻辑备份（mysqldump）</td><td>中小数据量、跨版本迁移</td></tr><tr><td></td><td>物理备份（xtrabackup）</td><td>大数据量、快速恢复</td></tr><tr><td>备份频率</td><td>全量</td><td>每周1次（如周日凌晨）</td></tr><tr><td></td><td>增量/差异</td><td>每天1次（如凌晨2点）</td></tr><tr><td>恢复目标</td><td>RPO（恢复点目标）</td><td>允许丢失的数据量（如≤1小时）</td></tr><tr><td></td><td>RTO（恢复时间目标）</td><td>恢复完成的最长时间（如≤30分钟）</td></tr><tr><td>备份保留</td><td>保留周期</td><td>生产环境建议保留30天（按合规要求调整）</td></tr><tr><td></td><td>清理策略</td><td>自动清理过期备份，避免存储溢出</td></tr></tbody></table><h4 id="_2-经典备份策略示例" tabindex="-1">2. 经典备份策略示例 <a class="header-anchor" href="#_2-经典备份策略示例" aria-label="Permalink to “2. 经典备份策略示例”">​</a></h4><ul><li><strong>中小业务（数据量＜100GB）</strong>： 每周日凌晨全量备份（mysqldump） + 每日凌晨增量备份（binlog） + 保留30天；</li><li><strong>中大型业务（数据量 100GB-1TB）</strong>： 每周日凌晨物理全量备份（xtrabackup） + 每6小时增量备份 + 实时binlog备份 + 保留90天；</li><li><strong>核心业务（数据量＞1TB）</strong>： 主从架构 + 从库备份（避免影响主库） + 异地备份 + 多副本存储。</li></ul><h3 id="_13-1-3-备份策略制定原则" tabindex="-1">13.1.3 备份策略制定原则 <a class="header-anchor" href="#_13-1-3-备份策略制定原则" aria-label="Permalink to “13.1.3 备份策略制定原则”">​</a></h3><ol><li><strong>最小权限</strong>：备份账号仅授予 <code>SELECT</code>、<code>LOCK TABLES</code>、<code>REPLICATION CLIENT</code> 等必要权限；</li><li><strong>错峰执行</strong>：备份安排在业务低峰期（如凌晨2-4点），避免影响正常业务；</li><li><strong>异地存储</strong>：备份文件除了本地存储，还需同步到异地服务器/云存储（如OSS），防止机房级故障；</li><li><strong>定期验证</strong>：每月至少1次模拟恢复，验证备份的有效性；</li><li><strong>自动化</strong>：通过脚本+定时任务（crontab）自动执行备份，避免人工遗漏。</li></ol><h2 id="_13-2-mysqldump工具的备份实战-全量-增量" tabindex="-1">13.2 mysqldump工具的备份实战（全量/增量） <a class="header-anchor" href="#_13-2-mysqldump工具的备份实战-全量-增量" aria-label="Permalink to “13.2 mysqldump工具的备份实战（全量/增量）”">​</a></h2><p>mysqldump 是 MySQL 官方自带的逻辑备份工具，无需额外安装，操作简单，适用于中小数据量的备份场景，支持全量备份和基于 binlog 的增量备份。</p><h3 id="_13-2-1-mysqldump-核心语法" tabindex="-1">13.2.1 mysqldump 核心语法 <a class="header-anchor" href="#_13-2-1-mysqldump-核心语法" aria-label="Permalink to “13.2.1 mysqldump 核心语法”">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 基础语法</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysqldump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 用户名</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 密码</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [选项] 数据库名 [表名] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 备份文件.sql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 常用选项</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--single-transaction</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 基于事务备份（InnoDB，不锁表）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--lock-tables</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # 不锁表（MyISAM慎用）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--master-data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # 记录备份时的binlog位置（增量备份必备）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--flush-logs</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          # 备份时刷新binlog（切割新日志，便于增量）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--databases</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           # 指定多个数据库</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--all-databases</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # 备份所有数据库</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--no-data</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             # 仅备份表结构，不备份数据</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_13-2-2-全量备份实战" tabindex="-1">13.2.2 全量备份实战 <a class="header-anchor" href="#_13-2-2-全量备份实战" aria-label="Permalink to “13.2.2 全量备份实战”">​</a></h3><h4 id="_1-备份单个数据库" tabindex="-1">1. 备份单个数据库 <a class="header-anchor" href="#_1-备份单个数据库" aria-label="Permalink to “1. 备份单个数据库”">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 备份test_db数据库（InnoDB，无锁）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysqldump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--single-transaction </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--master-data=2 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--flush-logs </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">test_db </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/test_db_full_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +%Y%m%d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.sql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 压缩备份（减少存储占用）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysqldump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--single-transaction </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">test_db </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> gzip</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/test_db_full_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +%Y%m%d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.sql.gz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_2-备份所有数据库" tabindex="-1">2. 备份所有数据库 <a class="header-anchor" href="#_2-备份所有数据库" aria-label="Permalink to “2. 备份所有数据库”">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysqldump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--single-transaction </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--master-data=2 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--all-databases </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/all_db_full_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +%Y%m%d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.sql</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_3-仅备份表结构" tabindex="-1">3. 仅备份表结构 <a class="header-anchor" href="#_3-仅备份表结构" aria-label="Permalink to “3. 仅备份表结构”">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysqldump</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--no-data </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">test_db </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/test_db_schema_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +%Y%m%d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.sql</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_13-2-3-基于binlog的增量备份" tabindex="-1">13.2.3 基于binlog的增量备份 <a class="header-anchor" href="#_13-2-3-基于binlog的增量备份" aria-label="Permalink to “13.2.3 基于binlog的增量备份”">​</a></h3><p>mysqldump 本身不支持增量备份，但可通过备份 binlog（二进制日志）实现增量，binlog 记录了所有数据变更操作，是增量备份的核心。</p><h4 id="_1-开启binlog-必备" tabindex="-1">1. 开启binlog（必备） <a class="header-anchor" href="#_1-开启binlog-必备" aria-label="Permalink to “1. 开启binlog（必备）”">​</a></h4><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 临时开启（重启失效）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> GLOBAL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> log_bin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SET</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> GLOBAL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> binlog_format </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ROW&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 行级日志，恢复更精准</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 永久开启（修改my.cnf/my.ini）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[mysqld]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">log_bin </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">var</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lib</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mysql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bin  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- binlog存储路径</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">binlog_format </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ROW</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 -- 行级格式</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                       -- 主从复制必备，唯一标识</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">expire_logs_days </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 7</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                -- binlog自动过期7天</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_2-备份binlog文件" tabindex="-1">2. 备份binlog文件 <a class="header-anchor" href="#_2-备份binlog文件" aria-label="Permalink to “2. 备份binlog文件”">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 手动备份当天的binlog</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/mysql/mysql-bin.0000[0-9]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/binlog/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +%Y%m%d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 自动化脚本（每天凌晨备份前一天的binlog）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BINLOG_DIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/var/lib/mysql</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BACKUP_DIR</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/backup/mysql/binlog/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +%Y%m%d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;yesterday&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $BACKUP_DIR</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $BINLOG_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/mysql-bin.0000[0-9]</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $BACKUP_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 压缩</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gzip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $BACKUP_DIR</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="_13-3-物理备份与逻辑备份的差异对比" tabindex="-1">13.3 物理备份与逻辑备份的差异对比 <a class="header-anchor" href="#_13-3-物理备份与逻辑备份的差异对比" aria-label="Permalink to “13.3 物理备份与逻辑备份的差异对比”">​</a></h2><p>MySQL 备份分为<strong>逻辑备份</strong>（如 mysqldump）和<strong>物理备份</strong>（如 xtrabackup），二者各有优劣，需根据数据量和恢复需求选择。</p><h3 id="_13-3-1-核心差异对比表" tabindex="-1">13.3.1 核心差异对比表 <a class="header-anchor" href="#_13-3-1-核心差异对比表" aria-label="Permalink to “13.3.1 核心差异对比表”">​</a></h3><table tabindex="0"><thead><tr><th>特性</th><th>逻辑备份（mysqldump）</th><th>物理备份（xtrabackup）</th></tr></thead><tbody><tr><td>备份对象</td><td>数据库的SQL语句（CREATE/INSERT）</td><td>数据库的物理文件（.ibd/.frm）</td></tr><tr><td>备份速度</td><td>慢（需逐条读取数据并生成SQL）</td><td>快（直接拷贝文件）</td></tr><tr><td>恢复速度</td><td>慢（需执行SQL语句插入数据）</td><td>快（直接拷贝文件到数据目录）</td></tr><tr><td>备份体积</td><td>大（文本格式，冗余多）</td><td>小（二进制格式，可压缩）</td></tr><tr><td>跨版本兼容性</td><td>好（SQL语句通用）</td><td>差（不同版本文件格式可能不同）</td></tr><tr><td>跨平台兼容性</td><td>好（可在不同OS间迁移）</td><td>差（文件系统相关）</td></tr><tr><td>锁表情况</td><td>InnoDB可通过--single-transaction无锁</td><td>几乎无锁（热备份）</td></tr><tr><td>适用数据量</td><td>＜100GB（中小数据量）</td><td>＞100GB（大数据量）</td></tr><tr><td>工具示例</td><td>mysqldump、mydumper</td><td>Percona XtraBackup、MySQL Enterprise Backup</td></tr></tbody></table><h3 id="_13-3-2-物理备份实战-xtrabackup" tabindex="-1">13.3.2 物理备份实战（xtrabackup） <a class="header-anchor" href="#_13-3-2-物理备份实战-xtrabackup" aria-label="Permalink to “13.3.2 物理备份实战（xtrabackup）”">​</a></h3><p>Percona XtraBackup 是开源的物理备份工具，支持 InnoDB 热备份（无锁），是大数据量场景的首选。</p><h4 id="_1-安装-xtrabackup" tabindex="-1">1. 安装 xtrabackup <a class="header-anchor" href="#_1-安装-xtrabackup" aria-label="Permalink to “1. 安装 xtrabackup”">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># CentOS/RHEL</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> percona-xtrabackup-80</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Ubuntu/Debian</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> percona-xtrabackup-80</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_2-全量物理备份" tabindex="-1">2. 全量物理备份 <a class="header-anchor" href="#_2-全量物理备份" aria-label="Permalink to “2. 全量物理备份”">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 全量备份</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xtrabackup</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --user=root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --password=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--backup </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--target-dir=/backup/mysql/xtrabackup_full_$(date </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+%Y%m%d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 备份完成后，准备恢复（生成一致性数据）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xtrabackup</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --prepare</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --target-dir=/backup/mysql/xtrabackup_full_$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +%Y%m%d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_3-增量物理备份" tabindex="-1">3. 增量物理备份 <a class="header-anchor" href="#_3-增量物理备份" aria-label="Permalink to “3. 增量物理备份”">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 基于全量备份做增量备份</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xtrabackup</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --user=root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --password=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--backup </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--target-dir=/backup/mysql/xtrabackup_incr_$(date </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">+%Y%m%d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--incremental-basedir</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/backup/mysql/xtrabackup_full_20260125</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 准备增量恢复（先准备全量，再合并增量）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xtrabackup</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --prepare</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --apply-log-only</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --target-dir=/backup/mysql/xtrabackup_full_20260125</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xtrabackup</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --prepare</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --apply-log-only</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --target-dir=/backup/mysql/xtrabackup_full_20260125</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--incremental-dir=/backup/mysql/xtrabackup_incr_20260126</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="_13-4-数据恢复的流程与实战操作" tabindex="-1">13.4 数据恢复的流程与实战操作 <a class="header-anchor" href="#_13-4-数据恢复的流程与实战操作" aria-label="Permalink to “13.4 数据恢复的流程与实战操作”">​</a></h2><p>恢复是备份的最终目的，不同备份类型的恢复流程不同，但核心原则是：<strong>先停止业务写入，再恢复数据，最后验证数据一致性</strong>。</p><h3 id="_13-4-1-逻辑备份恢复-mysqldump" tabindex="-1">13.4.1 逻辑备份恢复（mysqldump） <a class="header-anchor" href="#_13-4-1-逻辑备份恢复-mysqldump" aria-label="Permalink to “13.4.1 逻辑备份恢复（mysqldump）”">​</a></h3><h4 id="_1-恢复单个数据库" tabindex="-1">1. 恢复单个数据库 <a class="header-anchor" href="#_1-恢复单个数据库" aria-label="Permalink to “1. 恢复单个数据库”">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 先创建空数据库（若不存在）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;CREATE DATABASE IF NOT EXISTS test_db;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 恢复备份文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test_db</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/test_db_full_20260125.sql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 恢复压缩的备份文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gzip</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/test_db_full_20260125.sql.gz</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test_db</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_2-恢复所有数据库" tabindex="-1">2. 恢复所有数据库 <a class="header-anchor" href="#_2-恢复所有数据库" aria-label="Permalink to “2. 恢复所有数据库”">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/all_db_full_20260125.sql</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="_3-仅恢复单张表" tabindex="-1">3. 仅恢复单张表 <a class="header-anchor" href="#_3-仅恢复单张表" aria-label="Permalink to “3. 仅恢复单张表”">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 从全库备份中提取单表数据（先解压）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;CREATE TABLE \`user\`&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/test_db_full_20260125.sql</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 找到表结构起始行</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 提取表结构和数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sed</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;100,2000p&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/test_db_full_20260125.sql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/user_table.sql</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 恢复单表</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test_db</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/user_table.sql</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_13-4-2-物理备份恢复-xtrabackup" tabindex="-1">13.4.2 物理备份恢复（xtrabackup） <a class="header-anchor" href="#_13-4-2-物理备份恢复-xtrabackup" aria-label="Permalink to “13.4.2 物理备份恢复（xtrabackup）”">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 停止MySQL服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysqld</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 清空数据目录（注意：先确认备份有效）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/mysql/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3. 恢复备份文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">xtrabackup</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --copy-back</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --target-dir=/backup/mysql/xtrabackup_full_20260125</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4. 修改文件权限（MySQL运行用户为mysql）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chown</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysql:mysql</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/mysql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 5. 启动MySQL服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mysqld</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 6. 验证数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;SELECT COUNT(*) FROM test_db.user;&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_13-4-3-恢复注意事项" tabindex="-1">13.4.3 恢复注意事项 <a class="header-anchor" href="#_13-4-3-恢复注意事项" aria-label="Permalink to “13.4.3 恢复注意事项”">​</a></h3><ol><li><strong>停止写入</strong>：恢复前需暂停业务应用，禁止向数据库写入数据，避免数据冲突；</li><li><strong>备份当前数据</strong>：恢复前先备份当前数据库（即使已损坏），防止恢复失败无法回滚；</li><li><strong>权限检查</strong>：恢复后的文件权限需为 mysql:mysql，否则 MySQL 无法启动；</li><li><strong>日志检查</strong>：恢复后查看 MySQL 错误日志（/var/log/mysqld.log），确认无启动异常；</li><li><strong>数据验证</strong>：恢复后执行关键查询（如 COUNT、SUM），验证数据完整性。</li></ol><h2 id="_13-5-增量备份与point-in-time恢复" tabindex="-1">13.5 增量备份与point-in-time恢复 <a class="header-anchor" href="#_13-5-增量备份与point-in-time恢复" aria-label="Permalink to “13.5 增量备份与point-in-time恢复”">​</a></h2><p>point-in-time（PIT）恢复即“时间点恢复”，能将数据恢复到任意指定时间点，核心依赖 binlog 日志，适用于误操作后的精准恢复。</p><h3 id="_13-5-1-时间点恢复核心流程" tabindex="-1">13.5.1 时间点恢复核心流程 <a class="header-anchor" href="#_13-5-1-时间点恢复核心流程" aria-label="Permalink to “13.5.1 时间点恢复核心流程”">​</a></h3><ol><li>恢复全量备份（恢复到全量备份的时间点）；</li><li>解析 binlog，提取全量备份后到目标时间点的所有操作；</li><li>执行 binlog 中的操作，恢复到指定时间点。</li></ol><h3 id="_13-5-2-实战示例-恢复到误操作前的时间点" tabindex="-1">13.5.2 实战示例：恢复到误操作前的时间点 <a class="header-anchor" href="#_13-5-2-实战示例-恢复到误操作前的时间点" aria-label="Permalink to “13.5.2 实战示例：恢复到误操作前的时间点”">​</a></h3><h4 id="场景-2026-01-25-10-00-误删除了-test-db-user-表-需恢复到-2026-01-25-09-59。" tabindex="-1">场景：2026-01-25 10:00 误删除了 test_db.user 表，需恢复到 2026-01-25 09:59。 <a class="header-anchor" href="#场景-2026-01-25-10-00-误删除了-test-db-user-表-需恢复到-2026-01-25-09-59。" aria-label="Permalink to “场景：2026-01-25 10:00 误删除了 test_db.user 表，需恢复到 2026-01-25 09:59。”">​</a></h4><h4 id="步骤1-恢复全量备份-假设全量备份在-2026-01-25-02-00" tabindex="-1">步骤1：恢复全量备份（假设全量备份在 2026-01-25 02:00） <a class="header-anchor" href="#步骤1-恢复全量备份-假设全量备份在-2026-01-25-02-00" aria-label="Permalink to “步骤1：恢复全量备份（假设全量备份在 2026-01-25 02:00）”">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test_db</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/test_db_full_20260125.sql</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="步骤2-查找binlog位置和时间" tabindex="-1">步骤2：查找binlog位置和时间 <a class="header-anchor" href="#步骤2-查找binlog位置和时间" aria-label="Permalink to “步骤2：查找binlog位置和时间”">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看binlog列表</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/mysql/mysql-bin.0000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 解析binlog，找到误操作的时间点</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysqlbinlog</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-defaults</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --base64-output=DECODE-ROWS</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/var/lib/mysql/mysql-bin.000025 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--start-datetime=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2026-01-25 02:00:00&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">--stop-datetime=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2026-01-25 09:59:00&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/binlog_20260125_0200_0959.sql</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="步骤3-执行binlog恢复" tabindex="-1">步骤3：执行binlog恢复 <a class="header-anchor" href="#步骤3-执行binlog恢复" aria-label="Permalink to “步骤3：执行binlog恢复”">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 执行binlog文件，恢复到09:59</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test_db</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/binlog_20260125_0200_0959.sql</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="步骤4-跳过误操作的binlog-可选" tabindex="-1">步骤4：跳过误操作的binlog（可选） <a class="header-anchor" href="#步骤4-跳过误操作的binlog-可选" aria-label="Permalink to “步骤4：跳过误操作的binlog（可选）”">​</a></h4><p>若误操作的SQL在binlog中，可通过位置跳过：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 找到误操作的binlog位置（如pos=1200）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysqlbinlog</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-defaults</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/mysql/mysql-bin.000025</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;DROP TABLE user&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 恢复到pos=1199（误操作前）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysqlbinlog</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-defaults</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/lib/mysql/mysql-bin.000025</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --stop-position=1199</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_13-6-备份数据的验证与备份方案优化" tabindex="-1">13.6 备份数据的验证与备份方案优化 <a class="header-anchor" href="#_13-6-备份数据的验证与备份方案优化" aria-label="Permalink to “13.6 备份数据的验证与备份方案优化”">​</a></h2><h3 id="_13-6-1-备份数据的验证方法" tabindex="-1">13.6.1 备份数据的验证方法 <a class="header-anchor" href="#_13-6-1-备份数据的验证方法" aria-label="Permalink to “13.6.1 备份数据的验证方法”">​</a></h3><p>备份的核心是“可恢复”，仅备份不验证等于无备份，以下是常用的验证方法：</p><h4 id="_1-语法验证-基础" tabindex="-1">1. 语法验证（基础） <a class="header-anchor" href="#_1-语法验证-基础" aria-label="Permalink to “1. 语法验证（基础）”">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查备份文件的SQL语法是否合法</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --batch</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --execute=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SOURCE /backup/mysql/test_db_full_20260125.sql&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;&amp;1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> error</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_2-数据一致性验证-核心" tabindex="-1">2. 数据一致性验证（核心） <a class="header-anchor" href="#_2-数据一致性验证-核心" aria-label="Permalink to “2. 数据一致性验证（核心）”">​</a></h4><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1. 在测试环境恢复备份</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test_db_test</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/test_db_full_20260125.sql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2. 对比生产库和测试库的关键数据</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生产库</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;SELECT COUNT(*) FROM test_db.user; SELECT SUM(amount) FROM test_db.order;&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/prod_data.txt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试库</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;SELECT COUNT(*) FROM test_db_test.user; SELECT SUM(amount) FROM test_db_test.order;&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/test_data.txt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 对比文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">diff</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/prod_data.txt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp/test_data.txt</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_3-恢复演练-定期" tabindex="-1">3. 恢复演练（定期） <a class="header-anchor" href="#_3-恢复演练-定期" aria-label="Permalink to “3. 恢复演练（定期）”">​</a></h4><p>每月在测试环境执行一次完整的恢复流程，记录恢复时间，验证是否满足 RTO 要求：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 记录恢复开始时间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">start_time</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +%s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 执行恢复操作</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -u</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Root@123456&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test_db_test</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/test_db_full_20260125.sql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 记录恢复结束时间</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end_time</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +%s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 计算恢复耗时</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;恢复耗时：$((</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">end_time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> - start_time)) 秒&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_13-6-2-备份方案优化策略" tabindex="-1">13.6.2 备份方案优化策略 <a class="header-anchor" href="#_13-6-2-备份方案优化策略" aria-label="Permalink to “13.6.2 备份方案优化策略”">​</a></h3><h4 id="_1-性能优化" tabindex="-1">1. 性能优化 <a class="header-anchor" href="#_1-性能优化" aria-label="Permalink to “1. 性能优化”">​</a></h4><ul><li><strong>从库备份</strong>：主库不执行备份操作，在从库上备份，避免占用主库资源；</li><li><strong>压缩备份</strong>：使用 gzip/xz 压缩备份文件，减少存储占用（xtrabackup 支持 --compress）；</li><li><strong>并行备份</strong>：mydumper/xtrabackup 支持并行备份，提升备份速度（如 --threads=8）；</li><li><strong>增量备份替代全量</strong>：减少全量备份频率，增加增量备份频率，平衡速度和存储。</li></ul><h4 id="_2-可靠性优化" tabindex="-1">2. 可靠性优化 <a class="header-anchor" href="#_2-可靠性优化" aria-label="Permalink to “2. 可靠性优化”">​</a></h4><ul><li><strong>异地备份</strong>：将备份文件同步到异地服务器（如 rsync 到另一机房）或云存储（如 S3/OSS）；</li><li><strong>多副本存储</strong>：备份文件至少保留2个副本（本地+异地）；</li><li><strong>校验和验证</strong>：备份完成后生成 MD5 校验和，恢复前验证文件完整性：<div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">md5sum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/test_db_full_20260125.sql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/test_db_full_20260125.sql.md5</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 验证</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">md5sum</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql/test_db_full_20260125.sql.md5</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul><h4 id="_3-自动化优化" tabindex="-1">3. 自动化优化 <a class="header-anchor" href="#_3-自动化优化" aria-label="Permalink to “3. 自动化优化”">​</a></h4><ul><li><p><strong>定时任务</strong>：通过 crontab 自动执行备份脚本：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编辑crontab</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crontab</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 新增定时任务（每周日凌晨2点全量备份）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/scripts/mysql_full_backup.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/logs/full_backup_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +%Y%m%d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;&amp;1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 每日凌晨3点增量备份binlog</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/scripts/mysql_binlog_backup.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/logs/binlog_backup_</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">date</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +%Y%m%d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;&amp;1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li><li><p><strong>监控告警</strong>：备份脚本执行失败时发送邮件/短信告警：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 备份脚本中添加告警逻辑</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$?</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -ne</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ]; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">then</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;MySQL备份失败&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;MySQL备份告警&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> admin@example.com</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">fi</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li><li><p><strong>自动清理过期备份</strong>：避免备份文件占满磁盘：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 删除30天前的备份</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;*.sql&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -mtime</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +30</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -delete</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">find</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /backup/mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;*.sql.gz&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -mtime</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +30</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -delete</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul><h3 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to “总结”">​</a></h3><ol><li>备份策略需明确备份类型、频率、保留周期，核心遵循“全量+增量”组合，满足 RPO/RTO 要求；</li><li>逻辑备份（mysqldump）适用于中小数据量，物理备份（xtrabackup）适用于大数据量，二者各有优劣；</li><li>时间点恢复依赖 binlog，需先恢复全量备份，再通过 binlog 恢复到指定时间点；</li><li>备份验证是核心环节，需定期执行语法检查、数据一致性对比和恢复演练；</li><li>备份方案优化需从性能、可靠性、自动化三个维度入手，确保备份“快、稳、可恢复”。</li></ol><p>备份与恢复不是“一劳永逸”的工作，而是持续的体系化建设——只有定期演练、持续优化，才能在数据灾难发生时从容应对，将损失降到最低。</p>`,90)])])}const F=i(h,[["render",t]]);export{b as __pageData,F as default};
